---
layout: post
title: 掌控状态复杂的对象
---

有状态的对象可能会很不好掌控，但我们的现实世界就是有状态的，所以我们需要想办法去掌控它。

依我浅见，如果一个方法是纯函数式的，那么它可以定义在任何地方，甚至定义为全局最好，例如`len(str)`这种。如果要把它定义为方法，那么原则是让它的参数尽可能少。例如，`str.len`。这种方法，一个对象里塞得再多，也不会令人感到不便。我们一般自己定义的对象，方法数很难多得过`String`类，但同时易用程度也很难超得过`String`类。无论哪种语言，`String`类都是强大的典范。

但如果一个方法不是纯函数式的，那么它就修改了它之外的某个状态。不同方法会修改不同的外部状态，如果这些外部状态都是全局变量，则不合礼法。面向对象的好处是，把每个外部状态都放到各自不同的对象中封装起来。（这甚至不需要扯上继承与多态，所以最小子集的scheme用closure就能做到。）这样就方便我们推理每个对象的特点。

如果一个对象内部拥有许多个状态变量，那么这个对象究竟有多少个状态呢？岂不是这些状态变量各自的可能状态数的总乘积？那么它轻易就会超出一般IT民工大脑的理解范围，于是就会在其脑内产生困惑、焦虑、压抑以及变态杀人倾向等负面情绪。

一种可用的思考办法是设立一个虚构的`state`成员，用它来统一该对象可能所处的所有状态。假使一个对象有两个自有的成员变量`a`和`b`，`a`有10种不同的取值，`b`有15种不同的取值，那么`state`就是一个150种可能的枚举。那么，如果`a`和`b`的可能取值是无限的，该怎么办？用康托尔关于无限的推理办法，我们也是可以把两个任意整数映射到一个任意整数的，例如，一种效率未必高的办法是把`a=35`映射为`3050`，把`b=112`映射为`010102`，然后把它们加起来成为`state=13152`。

接下来，就比较有希望将想要分析的对象，用状态转换的方式来分析了。实际的分析往往没有上面所说的那样复杂，就好比一般的代码分析不需要诉诸图灵机抽象一样。但一旦遇到困难，也许上面的方法能够帮助我们整理思路。
